# 区域设置和键盘
d-i debian-installer/locale string zh_CN.UTF-8
d-i localechooser/supported-locales multiselect en_US.UTF-8 zh_CN.UTF-8
d-i console-setup/ask_detect boolean false
d-i keyboard-configuration/xkb-keymap select us
d-i keyboard-configuration/layoutcode string us


# 网络配置 禁用自动配置（DHCP / IPv6）
d-i netcfg/disable_autoconfig boolean true
d-i netcfg/disable_dhcp boolean true
d-i netcfg/confirm_static boolean true
d-i netcfg/disable_ipv6 boolean true
# 主机名和域名
d-i netcfg/get_hostname string Debian
d-i netcfg/get_domain string local

# 时区设置
d-i time/zone string Asia/Shanghai
d-i clock-setup/utc boolean true
d-i clock-setup/ntp boolean true

# Root用户密码
d-i passwd/root-password password Nihao0538
d-i passwd/root-password-again password Nihao0538
d-i passwd/make-user boolean false

### 自动化分区（手动选盘 + 无 swap）
d-i partman-auto/method string regular
d-i partman/choose_device select manual
# 自定义分区方案：EFI + 根分区（无 swap）
d-i partman-auto/expert_recipe string                           \
      uefi-noswap ::                                            \
              512 512 512 fat32                                 \
                      $primary{ } $bootable{ }                  \
                      method{ efi } format{ }                   \
                      mountpoint{ /boot/efi }                   \
              .                                                 \
              100% 100% 100% ext4                               \
                      $primary{ }                               \
                      method{ format } format{ }                \
                      use_filesystem{ } filesystem{ ext4 }      \
                      mountpoint{ / }                           .


# 禁止 swap 提示
d-i partman-basicfilesystems/no_swap boolean false
d-i partman-partitioning/no_swap boolean false

# 清理旧分区信息并确认写入
d-i partman-lvm/device_remove_lvm boolean true
d-i partman-md/device_remove_md boolean true
d-i partman/confirm_write_new_label boolean true
d-i partman/choose_partition select finish
d-i partman/confirm boolean true
d-i partman/confirm_nooverwrite boolean true

# APT软件源（阿里云镜像）
d-i mirror/country string manual
d-i mirror/http/hostname string mirrors.aliyun.com
d-i mirror/http/directory string /debian
d-i mirror/http/proxy string
d-i mirror/suite string bookworm
d-i mirror/udeb/components multiselect main contrib non-free

# 软件选择
tasksel tasksel/first multiselect standard
d-i pkgsel/include string sudo curl openssh-server 
popularity-contest popularity-contest/participate boolean false

# 系统更新和SSH配置
d-i pkgsel/upgrade select none
d-i pkgsel/ssh boolean true

# 后期安装命令（整合版）
d-i preseed/late_command string \
    INSTALL_DISK=$(debconf-get partman-auto/disk); \
    in-target apt-get update; \
    in-target apt-get install -y grub-efi-amd64 grub-pc grub2-common; \
    in-target grub-install $INSTALL_DISK; \
    in-target update-grub; \
    in-target sed -i 's/^#PermitRootLogin.*/PermitRootLogin yes/' /etc/ssh/sshd_config; \
    in-target sed -i 's/^#PasswordAuthentication.*/PasswordAuthentication yes/' /etc/ssh/sshd_config;

# 关闭默认引导加载程序 
grub-installer/skip boolean true

# 安装完成
d-i finish-install/reboot_in_progress note
